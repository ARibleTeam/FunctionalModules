FROM python:3.11-slim

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    DJANGO_SETTINGS_MODULE=main.settings

WORKDIR /app

COPY requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

# ‚õ≥Ô∏è –°–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
COPY . .

# üßπ –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏–∫—É
RUN python manage.py collectstatic --noinput

# üîÅ –ú–æ–Ω—Ç–∏—Ä—É–µ–º —Ç–æ–º–∞ (–Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
VOLUME /app/modules /app/files

# üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ gunicorn
CMD ["gunicorn", "main.wsgi:application", "--bind", "0.0.0.0:8000", "--workers", "3"]
